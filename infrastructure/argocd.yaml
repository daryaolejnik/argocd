---
apiVersion: argoproj.io/v1alpha1
kind: AppProject
metadata:
  name: infrastructure
  namespace: argocd
spec:
  description: infrastructure project
  sourceRepos:
    - "*"
  destinations:
    - name: in-cluster
      server: https://kubernetes.default.svc
      namespace: "*"
  clusterResourceWhitelist:
    - group: "*"
      kind: "*"

---
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  namespace: argocd
  name: ingress-nginx
  annotations:

spec:
  destination:
    namespace: infrastructure
    name: in-cluster

  syncPolicy:
    automated:
      prune: true
      selfHeal: true

  project: infrastructure
  source:
    repoURL: git@github.com:daryaolejnik/argocd.git
    targetRevision: HEAD
    path: infrastructure/ingress-nginx
# ---
# apiVersion: argoproj.io/v1alpha1
# kind: Application
# metadata:
#   namespace: argocd
#   name: metrics-server
#   annotations:

# spec:
#   destination:
#     namespace: infrastructure
#     name: in-cluster

#   syncPolicy:
#     automated:
#       prune: true
#       selfHeal: true

#   project: infrastructure
#   source:
#     repoURL: https://kubernetes-sigs.github.io/metrics-server/
#     targetRevision: 3.13.0
#     chart: metrics-server
#     helm:
#       releaseName: metrics-server
#       values:
